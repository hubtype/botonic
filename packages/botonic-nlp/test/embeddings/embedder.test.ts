import { DatabaseManager } from '../../src/embeddings/database-manager'
import { Embedder } from '../../src/embeddings/embedder'

describe('Embedder', () => {
  test('Generate embeddings matrix', async () => {
    const manager = new DatabaseManager('en', 'glove', 50)
    const embedder = await Embedder.with(manager)
    const matrix = await embedder.generateEmbeddingsMatrix(['red', 'blue'])
    expect(matrix.shape).toEqual([2, 50])
    expect(matrix.arraySync()).toEqual([
      [
        -0.12878000736236572,
        0.879800021648407,
        -0.606939971446991,
        0.12933999300003052,
        0.5867999792098999,
        -0.038245998322963715,
        -1.0407999753952026,
        -0.5288100242614746,
        -0.29563000798225403,
        -0.7256699800491333,
        0.21188999712467194,
        0.17112000286579132,
        0.19172999262809753,
        0.3609899878501892,
        0.03267199918627739,
        -0.2743000090122223,
        -0.19291000068187714,
        -0.10909000039100647,
        -1.0056999921798706,
        -0.9390100240707397,
        -1.0206999778747559,
        -0.6999499797821045,
        0.5718200206756592,
        -0.45135998725891113,
        -1.2144999504089355,
        -1.1953999996185303,
        -0.3275800049304962,
        1.4921000003814697,
        0.545740008354187,
        -1.0008000135421753,
        2.8450000286102295,
        0.26478999853134155,
        -0.4993799924850464,
        0.34365999698638916,
        -0.12574000656604767,
        0.590499997138977,
        -0.037696000188589096,
        -0.4717499911785126,
        0.05082499980926514,
        -0.20362000167369843,
        0.13695000112056732,
        0.2668600082397461,
        -0.19460999965667725,
        -0.7548199892044067,
        1.0303000211715698,
        -0.05746699869632721,
        -0.3232699930667877,
        -0.7712000012397766,
        -0.16764000058174133,
        -0.738349974155426,
      ],
      [
        -0.8375099897384644,
        0.6956300139427185,
        -0.5140799880027771,
        0.2368900030851364,
        0.591920018196106,
        -0.027490999549627304,
        -1.2075999975204468,
        -0.9879599809646606,
        -0.27658000588417053,
        -0.4618000090122223,
        0.4715000092983246,
        0.13072000443935394,
        0.5039299726486206,
        0.5055599808692932,
        -0.6676599979400635,
        0.06907299906015396,
        -0.6098399758338928,
        -0.22776000201702118,
        -1.2481000423431396,
        -1.3521000146865845,
        -0.560509979724884,
        -0.17951999604701996,
        0.228860005736351,
        -0.6924399733543396,
        -1.1734000444412231,
        -0.987779974937439,
        -0.8155099749565125,
        1.551300048828125,
        0.3651700019836426,
        -1.1161999702453613,
        2.631999969482422,
        0.21987000107765198,
        0.10694999992847443,
        0.2843799889087677,
        -0.10347999632358551,
        -0.29666998982429504,
        -0.1764499992132187,
        -0.7583799958229065,
        0.08552300184965134,
        -0.8364099860191345,
        -0.12173999845981598,
        -0.06316500157117844,
        -0.07205300033092499,
        -0.3071199953556061,
        0.6186100244522095,
        -0.3086700141429901,
        0.012373999692499638,
        -1.1965999603271484,
        0.04152499884366989,
        -0.23965999484062195,
      ],
    ])
  })
})
